{% extends 'public/base.html' %}
{% load static %}
{% load mathfilters %}
{% block title %} {{case.title}} - Case Details {% endblock %}


{% block content %}
<div class="wrapper">
  <div class="section features-1">
  <div class="container">
    <div class="row">
      <div class="col-md-8 mx-auto text-center">
        <h4 class="display-3">Case Details</h4>
      </div>
    </div><br>
    <div class="row justify-content-center">
      <div class="col-lg-7 mb-5 py-4 px-4">
        <div class="info pb-4 px-3">

          <div class="container mb-4" style="width: 70%;">
            <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
              <ol class="carousel-indicators">
                <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                {% for d in case.extraimages_set.all %}
                <li data-target="#carouselExampleIndicators" data-slide-to="{{ forloop.counter1 }}"></li>
                {% endfor %}
              </ol>
              <div class="carousel-inner">
                {% if case.thumbnail %}
                <div class="carousel-item active">
                  <img src="{{ case.thumbnail.url }}" class="img-fluid">
                </div>
                {% endif %}
                {% for d in case.extraimages_set.all %}
                  <div class="carousel-item">
                    <img class="img-fluid" src="{{d.img.url}}">
                  </div>
                {% endfor %}
              </div>
              <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
              </a>
              <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
              </a>
            </div>
          </div>

          <h4 class="info-title text-uppercase text-primary">{{case.title}}</h4>
          <h6><b>Case Id: </b> {{ case.custom_id }}</h6>

          <span class="badge badge-secondary badge-pill mb-3 text-white">{{case.type}}</span>
          <span class="
             badge {% if case.status == 'Green' %} badge-success
             {% elif case.status == 'Orange' %} badge-warning
             {% elif case.status == 'Red' %} badge-danger
             {% elif case.status == 'Closed' %} badge-default {% endif %}
             badge-pill mb-3">
            {{case.status}}
          </span>

          <p class="description display-4">
            {{ case.description|safe }}
          </p>
          <p class="paragraph">Created By: <a href="#">{{case.created_by.user}}</a></p>
          {% if case.type == 'Medical' %}
            <ul>
              <li>Nature Of Disease: {{case.medicalcase.nature_of_disease}}</li>
              <li>Hospital: {{case.medicalcase.name_of_hospital}}</li>
              <li>Admitted: {{case.medicalcase.admitted_in_hospital}}</li>
            </ul>
            <h5 class="display-5">Files : </h5>

            <ul>
              <li>Estimation Letter:
                {% if case.medicalcase.estimation_letter %}
                  <a href="{{MEDIA_URL}}{{case.medicalcase.estimation_letter.url }}">{{case.medicalcase.estimation_letter}}</a>
                {% else %}
                  <b>This File Was Not Provided</b>
                {% endif %}
              </li>
            </ul>

          {% elif case.type == 'Medicine' %}
            <ul>
              <li>Nature Of Disease: {{case.medicinecase.nature_of_disease}}</li>
              <li>Medicine: {{case.medicinecase.name_of_medicine}}</li>
              <li>Hospital: {{case.medicinecase.name_of_hospital}}</li>
            </ul>
            <h5 class="display-5">Files : </h5>

            <ul>
              <li>Estimation Letter:
                {% if case.medicinecase.estimation_letter %}
                  <a href="{{MEDIA_URL}}{{case.medicinecase.estimation_letter.url }}">{{case.medicinecase.estimation_letter}}</a>
                {% else %}
                  <b>This File Was Not Provided</b>
                {% endif %}
              </li>
            </ul>

          {% elif case.type == 'Provisional' %}
            <ul>
              <li>Marital Status: {{case.provisionalcase.marital_status}}</li>
            </ul>

            {% if case.provisionalcase.marital_status == 'Widow' %}
              <h5 class="display-5">Files : </h5>

              <ul>
                <li>Death Certificate: <a href="{{MEDIA_URL}}{{case.provisionalcase.death_cert.url }}">{{case.provisionalcase.death_cert}}</a></li>
              </ul>
            {% endif %}

          {% elif case.type == 'Educational' %}
            <ul>
              <li>Is an orphan: {{case.educationalcase.is_orphan}}</li>
              <li>Father/Mother/Guardian: {{case.educationalcase.guardian}}</li>
              <li>Name of school: {{case.educationalcase.name_of_school}}</li>
              <li>Location of school: {{case.educationalcase.location_of_school}}</li>
              <li>Grade: {{case.educationalcase.grade}}</li>
            </ul>

            <h5 class="display-5">Files : </h5>

            <ul>
              {% if case.educationalcase.is_orphan %}
              <li>Death Certificate:
                {% if case.educationalcase.death_cert %}
                  <a href="{{MEDIA_URL}}{{case.educationalcase.death_cert.url }}">{{case.educationalcase.death_cert}}</a>
                {% else %}
                  <b>File was not provided</b>
                {% endif %}
              </li>
              {% endif %}
              <li>Fee Structure:
                {% if case.educationalcase.fee_structure %}
                <a href="{{MEDIA_URL}}{{case.educationalcase.fee_structure.url }}">{{case.educationalcase.fee_structure}}</a>
                {% else %}
                <b>File was not provided</b>
                {% endif %}
              </li>
            </ul>


          {% else %}
            <ul>
              <li>Nature Of Aid: {{case.generalcase.nature_of_aid}}</li>
            </ul>
            <h5 class="display-5">Files : </h5>
            <ul>
              <li>Estimated Cost Certificate:
                {% if case.generalcase.estimated_cost_cert %}
                  <a href="{{MEDIA_URL}}{{case.generalcase.estimated_cost_cert.url }}">{{case.generalcase.estimated_cost_cert}}</a>
                {% else %}
                  <b>This file was not provided</b>
                {% endif %}
              </li>
            </ul>
          {% endif %}

          <h5 class="display-5">Additional Documents</h5>
          <ul>
            {% for d in case.extradocs_set.all %}
              <li><a href="{{MEDIA_URL}}{{d.doc.url }}">{{d.doc}}</a></li>
            {% endfor %}
          </ul>

            <p class="description display-4">
              Submitted on: {{case.date_of_initiation.date}}
            </p>
            <p class="description display-3">
              Financial Assistance From Other Sources: {{case.other_financial_assistance}}
            </p>
          <div class="progress-wrapper">
            {% with rat=case.proper_total|div:case.requested_amount %}
            <div class="progress-info">
              <div class="progress-label">
                <h6>Raised &#8377;{{case.proper_total}} of &#8377;{{case.requested_amount}}</h6>
              </div>
              <div class="progress-percentage">
                <span>{{ rat|mul:100|floatformat:2 }}%</span>
              </div>
            </div>
            <div class="progress">
              <div class="progress-bar bg-primary"
                   role="progressbar" aria-valuenow="{{case.proper_total}}" aria-valuemin="0"
                   aria-valuemax="{{case.requested_amount}}" style="width: {{ rat|mul:100 }}%;"></div>
            </div>
            {% endwith %}
          </div>
        </div>
      </div>
      {% if case.status == 'Green' %}
        <div x-data="{ amount: 0 }" class="col-lg-5 mb-5 py-4 px-4">
          <div class="info pb-4 px-3">
            <h4 class="info-title text-uppercase text-primary">Donate</h4>
            <form method="post" action="{% url 'checkout' case.id %}">
              <input type="text" value="{{ case.type }}" hidden name="type">
              {% if request.user.is_authenticated %}
              <label>Enter Amount</label>
              <input x-model="amount" class="form-control" name="amount" type="text" placeholder="Enter Amount (&#8377;)" required><br>
              <label>Pan No.</label>
              <input class="form-control mb-2" name="pan" type="text" placeholder="PAN No." :required="amount > 4999">
              <p>PAN Number is Mandatory for donations above &#8377;5000/- to issue 80G and 12A receipt.</p>
              <template x-if="amount > 4999">
                  <p>For the donation above &#8377;5000/- PAN number of individual/company/institution is mandatory as per income tax department</p>
              </template>

                {% if request.user.userprofile_set.all.first %}
                  <input type="submit" value="Donate" class="btn btn-primary">
                {% else %}
                  <a href="{% url 'complete_profile' %}" class="btn btn-primary">Donate</a>
                {% endif %}

              {% else %}
                <label>First Name</label>
                <input class="form-control mb-2" name="first_name" type="text" placeholder="John" required>

                <label>Last Name</label>
                <input class="form-control mb-2" name="last_name" type="text" placeholder="Doe" required>

                <label>Gender</label>
                <select class="form-control mb-2" name="gender" required>
                  <option value="" selected>----</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                </select>

                <label>PAN No.</label>
                <input class="form-control mb-2" name="pan" type="text" placeholder="PAN No." :required="amount > 4999">
                <p>PAN Number is Mandatory for donations above &#8377;5000/- to issue 80G and 12A receipt.</p>
                <template x-if="amount > 4999">
                    <p>For the donation above &#8377;5000/- PAN number of individual/company/institution is mandatory as per income tax department</p>
                </template>

                <label>Address</label>
                <input class="form-control mb-2" name="address" type="text" placeholder="Address" required>

                <label>City</label>
                <input class="form-control mb-2" name="city" type="text" placeholder="City" required>
                <label>State</label>
                <input class="form-control mb-2" name="state" type="text" placeholder="State" required>
                <label>Country</label>
                <input class="form-control mb-2" name="country" type="text" placeholder="Country" required>

                <label>Phone Number</label>
                <input class="form-control mb-2" name="phone" type="tel" placeholder="Phone Number" required>

                <label>Email</label>
                <input class="form-control mb-2" name="email" type="email" placeholder="john@mail.com" required>

                <label>Enter Amount</label>
                <input x-model="amount" class="form-control" name="amount" type="text" placeholder="Enter Amount (&#8377;)" required><br>

                <input type="submit" value="Donate" class="btn btn-primary">
              {% endif %}
            </form>
          </div>
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}