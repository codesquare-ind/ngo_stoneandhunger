{% extends 'administration/admin_base.html' %}
{% block content %}
<div class="header bg-primary pb-6">
  <div class="container-fluid">
    <div class="header-body">
      <div class="row align-items-center py-4">
        <div class="col-lg-6 col-7">
          <nav aria-label="breadcrumb" class="d-none d-md-inline-block ml-md-4">
            <ol class="breadcrumb breadcrumb-links breadcrumb-dark">
              <li class="breadcrumb-item"><a href="#"><i class="fas fa-home"></i></a></li>
              <li class="breadcrumb-item"><a href="#">Cases</a></li>
              <li class="breadcrumb-item"><a href="#">{{case.title}}</a></li>
            </ol>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="container-fluid mt--6">
  <div class="row">
    <div class="{% if case.status == 'Green' %} col-xl-8 {% else %} col-xl-12 {% endif %}">
      <div class="card">
        <div class="card-header">
          <div class="row align-items-center">
            <div class="col-6">
              <h3 class="mb-0">Case Details </h3>
            </div>
            <div class="col-6">
              {% if case.status != 'Green' and case.status != 'Closed' %}
                <a href="{% url 'a_approve' case.uuid %}" class="btn btn-sm btn-success">Approve</a>
              {% endif %}
              <a href="{% url 'a_edit' case.uuid %}" class="btn btn-sm btn-primary">Edit Case</a>
              <a href="{% url 'a_close' case.uuid %}" class="btn btn-sm btn-default">Close Case</a>
              {% if request.user.get_group != 'subadmin' %}
              <a href="{% url 'a_delete' case.uuid %}" class="btn btn-sm btn-danger">Delete</a>
              {% endif %}
              {% if case.status == 'Orange' %}
                <a href="{% url 'a_reject' case.uuid %}" class="btn btn-sm btn-danger">Reject Case</a>
              {% endif %}
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="container mb-4" style="width: 70%;">
            <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
              <ol class="carousel-indicators">
                <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                {% for d in case.extraimages_set.all %}
                <li data-target="#carouselExampleIndicators" data-slide-to="{{ forloop.counter1 }}"></li>
                {% endfor %}
              </ol>
              <div class="carousel-inner">
                {% if case.thumbnail %}
                <div class="carousel-item active">
                  <img src="{{ case.thumbnail.url }}" class="img-fluid">
                </div>
                {% endif %}
                {% for d in case.extraimages_set.all %}
                  <div class="carousel-item">
                    <img class="img-fluid" src="{{d.img.url}}">
                  </div>
                {% endfor %}
              </div>
              <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
              </a>
              <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
              </a>
            </div>
          </div>
          {% for m in messages %}
          <div class="alert alert-default" role="alert">
            {{m}}
          </div>
          {% endfor %}

          <h4 class="info-title text-uppercase text-primary">{{case.title}}</h4>
          <span class="badge badge-secondary badge-pill mb-3 text-white">{{case.type}}</span>

          <span class="
             badge {% if case.status == 'Green' %} badge-success
             {% elif case.status == 'Orange' %} badge-warning
             {% elif case.status == 'Red' %} badge-danger
             {% elif case.status == 'Closed' %} badge-default {% endif %}
             badge-pill mb-3">
            {{case.status}}
          </span>

          <p class="description display-4">
            {{case.description|safe}}
          </p>
          <p class="paragraph">Created By: <a href="#">{{case.created_by.user}}</a></p>
          {% if case.type == 'Medical' %}
            <ul>
              <li>Nature Of Disease: {{case.medicalcase.nature_of_disease}}</li>
              <li>Hospital: {{case.medicalcase.name_of_hospital}}</li>
              <li>Admitted: {{case.medicalcase.admitted_in_hospital}}</li>
            </ul>
            <p class="description display-1">Files : </p>

            <ul>
              <li>Estimation Letter:
                {% if case.medicalcase.estimation_letter %}
                  <a href="{{MEDIA_URL}}{{case.medicalcase.estimation_letter.url }}">{{case.medicalcase.estimation_letter}}</a>
                {% else %}
                  <b>This File Was Not Provided</b>
                {% endif %}
              </li>
            </ul>

          {% elif case.type == 'Medicine' %}
            <ul>
              <li>Nature Of Disease: {{case.medicinecase.nature_of_disease}}</li>
              <li>Medicine: {{case.medicinecase.name_of_medicine}}</li>
              <li>Hospital: {{case.medicinecase.name_of_hospital}}</li>
            </ul>
            <p class="description display-1">Files : </p>

            <ul>
              <li>Estimation Letter:
                {% if case.medicinecase.estimation_letter %}
                  <a href="{{MEDIA_URL}}{{case.medicinecase.estimation_letter.url }}">{{case.medicinecase.estimation_letter}}</a>
                {% else %}
                  <b>This File Was Not Provided</b>
                {% endif %}
              </li>
            </ul>

          {% elif case.type == 'Provisional' %}
            <ul>
              <li>Marital Status: {{case.provisionalcase.marital_status}}</li>
            </ul>

            {% if case.provisionalcase.marital_status == 'Widow' %}
              <p class="description display-1">Files :</p>

              <ul>
                <li>Death Certificate: <a href="{{MEDIA_URL}}{{case.provisionalcase.death_cert.url }}">{{case.provisionalcase.death_cert}}</a></li>
              </ul>
            {% endif %}

          {% elif case.type == 'Educational' %}
            <ul>
              <li>Is an orphan: {{case.educationalcase.is_orphan}}</li>
              <li>Father/Mother/Guardian: {{case.educationalcase.guardian}}</li>
              <li>Name of school: {{case.educationalcase.name_of_school}}</li>
              <li>Location of school: {{case.educationalcase.location_of_school}}</li>
              <li>Grade: {{case.educationalcase.grade}}</li>
            </ul>

            <p class="description display-1">Files : </p>

            <ul>
              {% if case.educationalcase.is_orphan %}
              <li>Death Certificate:
                {% if case.educationalcase.death_cert %}
                  <a href="{{MEDIA_URL}}{{case.educationalcase.death_cert.url }}">{{case.educationalcase.death_cert}}</a>
                {% else %}
                  <b>File was not provided</b>
                {% endif %}
              </li>
              {% endif %}
              <li>Fee Structure:
                {% if case.educationalcase.fee_structure %}
                <a href="{{MEDIA_URL}}{{case.educationalcase.fee_structure.url }}">{{case.educationalcase.fee_structure}}</a>
                {% else %}
                <b>File was not provided</b>
                {% endif %}
              </li>
            </ul>


          {% else %}
            <ul>
              <li>Nature Of Aid: {{case.generalcase.nature_of_aid}}</li>
            </ul>
            <p class="description display-1">Files : </p>

            <ul>
              <li>Estimated Cost Certificate:
                {% if case.generalcase.estimated_cost_cert %}
                  <a href="{{MEDIA_URL}}{{case.generalcase.estimated_cost_cert.url }}">{{case.generalcase.estimated_cost_cert}}</a>
                {% else %}
                  <b>This file was not provided</b>
                {% endif %}
              </li>
            </ul>
          {% endif %}

            <p class="description display-4">
              Submitted on: {{case.date_of_initiation.date}}
            </p>
            <p class="description display-3">
              Financial Assistance From Other Sources: {{case.other_financial_assistance}}
            </p>

            {% if case.status == 'Closed' %}
            <h2 class="display-4">Closing Documents</h2>
            <ul>
              {% for d in case.closeddocs_set.all %}
                <li><a href="{{MEDIA_URL}}{{d.doc.url }}">{{d.doc}}</a></li>
              {% endfor %}
            </ul>
            <hr>
            <form role="form" method="POST" action="{% url 'a_close' case.uuid %}" enctype="multipart/form-data">
              {% csrf_token %}
                <div class="form-group mb-3">
                    <label class="form-control-label">Add New Closing Documents</label>
                    <div class="input-group input-group-merge input-group-alternative">
                        <input type="file" class="form-control" name="c_docs" multiple>
                    </div>
                </div>
                <div class="text-center">
                    <input type="submit" class="btn btn-primary my-4" value="Add New Documents">
                </div>
            </form>
          {% endif %}
          <h2 class="display-5">Extra Documents</h2>
          <ul>
            {% for d in case.extradocs_set.all %}
              <li><a href="{{MEDIA_URL}}{{d.doc.url }}">{{d.doc}}</a></li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
    {% if case.status == 'Green' %}
    <div class="col-xl-4">
        <div class="card">
        <div class="card-header">
          <div class="row align-items-center">
            <div class="col-8">
              <h3 class="mb-0">Case Progress </h3>
            </div>
          </div>
        </div>
        <div class="card-body">

            <div class="progress-wrapper">
                <div class="progress-info">
                  <div class="progress-label">
                    <h3>Raised <b>&#8377;{{case.proper_total}}</b> of <b>&#8377;{{case.requested_amount}}</b></h3>
                  </div>
                  <div class="progress-percentage">
                    <span>{{ progress|floatformat:2 }}%</span>
                  </div>
                </div>
                <div class="progress">
                  <div class="progress-bar bg-primary"
                       role="progressbar" aria-valuenow="{{case.total_collected}}"
                       aria-valuemin="0" aria-valuemax="{{case.requested_amount}}" style="width: {{progress}}%"></div>
                </div>
              </div>
            </div>
        </div>
    </div>
    {% endif %}

  </div>
{% if case.status == 'Green' %}
</div>
<div class="container-fluid">
  <div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header border-0">
              <div class="row align-items-center">
                <div class="col">
                  <h3 class="mb-0">Donations Received</h3>
                </div>
              </div>
            </div>
            <div class="table-responsive">
              <!-- Projects table -->
              <table class="table align-items-center table-flush">
                <thead class="thead-light">
                  <tr>
                    <th scope="col">Donor</th>
                    <th scope="col">Amount</th>
                    <th scope="col">Date</th>
                  </tr>
                </thead>
                <tbody>
                {% for donation in donations %}
                  <tr>
                    <th scope="row">
                      {{donation.donor}}
                    </th>
                    <td>
                      {{donation.amount}}
                    </td>
                    <td>
                      {{donation.date.date}}
                    </td>
                  </tr>
                {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
    </div>
  </div>
  {% endif %}
{% endblock %}